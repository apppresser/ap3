<ion-header>

  <ion-navbar>
    
    <ion-buttons start>
    <button *ngIf="rtlBack||is_registration_page" (click)="backRtlTransition()" ion-button class="custom-back-button">
        <ion-icon name="arrow-back"></ion-icon>
        {{ 'Back' | translate }}
    </button>

    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>

    </ion-buttons>

    <img class="header-logo" *ngIf="show_header_logo" [src]="header_logo_url" />

    <ion-title *ngIf="!show_header_logo && !singleThread">{{ title | translate }}</ion-title>

    <div *ngIf="singleThread" class="message-header-sender">

      <img *ngIf="navParams.data.senderAvatar" [src]="navParams.data.senderAvatar" class="message-header-avatar">

      <!-- <span class="message-header-name" *ngIf="navParams.data.senderName">{{ navParams.data.senderName }}</span> -->

    </div>

    <ion-buttons end>

      <button ion-button *ngIf="!singleThread" (tap)="newMessage()">
        <ion-icon name="ios-send"></ion-icon>
      </button>
    </ion-buttons>

  </ion-navbar>

  <ion-item *ngIf="messageSegments" id="favorites-toolbar" color="light">

    <ion-select [(ngModel)]="segment" (ionChange)="segmentChanged()" placeholder="{{ 'Inbox' | translate }}">

      <ion-option *ngFor="let segment of messageSegments" [value]="segment.name">{{ segment.name | translate }}</ion-option>

    </ion-select>

  </ion-item>

</ion-header>

<ion-content #content [ngClass]="customClasses">

  <!-- <ion-infinite-scroll *ngIf="singleThread" (ionInfinite)="loadMore($event)" position="top">
    <ion-infinite-scroll-content></ion-infinite-scroll-content>
  </ion-infinite-scroll> -->

  <div *ngIf="threads && !singleThread">

    <ion-list no-lines>

        <ion-item *ngFor="let thread of threads" (tap)="loadThread(thread)">
          <ion-avatar item-start>
            <img *ngIf="thread.recipients[thread.last_sender_id]?.user_avatars?.thumb" [src]="formatUrl( thread.recipients[thread.last_sender_id].user_avatars.thumb )">
            <img *ngIf="!thread.recipients[thread.last_sender_id]?.user_avatars?.thumb" src="assets/default.png">
          </ion-avatar>
          <p *ngIf="thread.recipients[thread.last_sender_id]?.user_display_name"><strong>{{ thread.recipients[thread.last_sender_id]?.user_display_name }}</strong></p>
          <p class="message-preview"><strong *ngIf="thread.subject.rendered && thread.subject.rendered != 'undefined'" [innerHTML]="getSubject( thread.subject.rendered )"></strong> <span [innerHTML]="thread.message.rendered"></span></p>
          <p *ngIf="thread.date" class="message-date">{{ thread.date | date }}</p>
          
        </ion-item>

    </ion-list>

  </div>

  <div *ngIf="threads && singleThread">

    <ion-list no-lines class="single-message-thread">
        <ion-item *ngFor="let message of threads[0].messages" [ngClass]="{ 'my-reply' : message.sender_id == login_data.user_id }" text-wrap>
          <ion-avatar item-start>
            <img *ngIf="threads[0].recipients[message.sender_id]?.user_avatars?.thumb" [src]="formatUrl( threads[0].recipients[message.sender_id]?.user_avatars?.thumb )">
            <img *ngIf="!threads[0].recipients[message.sender_id]?.user_avatars?.thumb" src="assets/default.png">
            <p *ngIf="threads[0].recipients[message.sender_id]?.user_display_name" class="sender-name">{{ threads[0].recipients[message.sender_id]?.user_display_name }}</p>
          </ion-avatar>
            
            <p class="message-preview"><strong>{{ getSubject( message.subject.rendered ) }}</strong> <span [innerHTML]=" message.message.rendered | doLinks"></span></p>

        </ion-item>
        <ion-item class="progress-message" *ngIf="progressMessage">
          {{ progressMessage }}
        </ion-item>
    </ion-list>

  </div>

  <ion-item *ngIf="!threads">{{ 'No items to show.' | translate }}</ion-item>

</ion-content>

<ion-footer no-border>
  <ion-toolbar *ngIf="threads && singleThread">
    <div class="reply-container">
      <div class="reply-row-container">
        <div class="input-container">
          <ion-input [(ngModel)]="threadReply" name="threadReply" type="text"></ion-input>
        </div>
        <div class="buttons-container">
          <button ion-button icon-only (click)="sendImage()">
            <ion-icon name="ios-camera"></ion-icon>
          </button>
          <button ion-button icon-only (click)="replyToThread()" [disabled]="threadReply === ''">
            <ion-icon name="ios-send"></ion-icon>
          </button>
        </div>
      </div>
    </div>
  </ion-toolbar>
</ion-footer>