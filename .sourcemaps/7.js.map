{"version":3,"sources":["../../src/pages/login-modal/login-modal.module.ts","../../src/pages/login-modal/login-modal.ts"],"names":[],"mappings":"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","file":"7.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { LoginModal } from './login-modal';\n\n@NgModule({\n  declarations: [\n    LoginModal,\n  ],\n  imports: [\n    IonicPageModule.forChild(LoginModal),\n    TranslateModule.forChild()\n  ],\n  exports: [\n    LoginModal\n  ]\n})\nexport class LoginModalModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login-modal/login-modal.module.ts","import { Component } from '@angular/core';\nimport { Events, ViewController, ToastController, LoadingController, IonicPage } from 'ionic-angular';\nimport {WPlogin} from '../../providers/wplogin/wplogin';\nimport {Logins} from \"../../providers/logins/logins\";\nimport {FbConnectApp} from '../../providers/facebook/login-app';\nimport {FbConnectIframe} from '../../providers/facebook/login-iframe';\nimport {FBConnectAppSettings} from '../../providers/facebook/fbconnect-settings';\nimport { Storage } from '@ionic/storage';\nimport {Device} from '@ionic-native/device';\nimport {TranslateService} from '@ngx-translate/core';\n\n@IonicPage()\n@Component({\n  selector: 'page-login-modal',\n  templateUrl: 'login-modal.html'\n})\nexport class LoginModal {\n\n\tlogin:any = {}\n\tlogin_data: any\n\tspinner: any\n\tforce_login: any = false;\n\tis_preview: boolean = false;\n\tfb_login: boolean = false;\n\tfb_login_data: any\n\n\tconstructor(\n\t\tpublic viewCtrl: ViewController,\n\t\tpublic loadingCtrl: LoadingController,\n\t\tpublic wplogin: WPlogin,\n\t\tprivate logins: Logins,\n\t\tpublic events: Events,\n\t\tpublic storage: Storage,\n\t\tpublic translate: TranslateService,\n\t\tprivate fbconnectApp: FbConnectApp,\n\t\tprivate fbconnectvars: FBConnectAppSettings,\n\t\tprivate Device: Device\n\t\t) {\n\n\t\t// login through postmessage sets login_data this way\n\t\tevents.subscribe('modal:logindata', data => {\n\t      this.setLoginData(data);\n\t    });\n\n\t\t// get login data on first load\n\t\tthis.storage.get('user_login').then( data => {\n\n\t\t\tif(data) {\n\t\t\t  this.login_data = data\n\t\t\t}\n\n\t\t});\n\n\t\tthis.storage.get('force_login').then( data => {\n\t\t\tif(data) {\n\t\t\t\tthis.force_login = true;\n\t\t\t}\n\t\t})\n\n\t\tthis.initFBLogin();\n\n\t\tthis.is_preview = (location.href.indexOf('myapppresser') > 0);\n\n\t}\n\n\t/**\n\t * The FB login button will only display after settings are received\n\t * \n\t * fb_login: true|false to show the button\n\t */\n\tinitFBLogin() {\n\t\tthis.fb_login = (this.fbconnectvars.get_nonce()) ? true : false;\n\n\t\tif(this.fb_login === false) {\n\t\t\tsetTimeout(()=>{\n\n\t\t\t\tthis.fb_login = (this.fbconnectvars.get_nonce()) ? true : false;\n\n\t\t\t\tif(this.fb_login === false) {\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\n\t\t\t\t\t\tthis.fb_login = (this.fbconnectvars.get_nonce()) ? true : false;\n\t\t\t\t\t}, 5000); // iOS seems to take longer\n\t\t\t\t}\n\t\t\t}, 3000); // Slow on first app load\n\t\t}\n\t}\n\n\tdoLogin() {\n\n\t\t// if in preview, Device.platform is empty object. On device it should be string like 'iOS'\n\t\t// checking for port 8100 let's me test logins locally\n\t\tif( typeof this.Device.platform != 'string' && location.port != '8100') {\n\n\t\t\tthis.translate.get('Please try from a device.').subscribe( text => {\n\t\t\t\talert(text);\n\t\t\t})\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tthis.translate.get('Please enter a valid login.').subscribe( text => {\n\t\t\tif( !this.login )\n\t\t\t\talert(text)\n\t\t})\n\n\t\tthis.showSpinner()\n\n\t\tthis.wplogin.login( this.login ).then( response => {\n\n\t\t\tif( (<any>response).success === false ) {\n\t\t\t\tthis.loginErr( response )\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet login_data = (<any>response).data;\n\t\t\tif(login_data && login_data.avatar)\n\t\t\t\tlogin_data.avatar = this.logins.fixProtocolRelativeUrl(login_data.avatar);\n\n\t\t\tthis.storage.set( 'user_login', login_data )\n\t\t\tthis.events.publish('user:login', login_data )\n\t\t\tthis.login_data = login_data\n\t\t\tthis.dismiss()\n\n\t\t\tthis.hideSpinner()\n\n\t\t}, (err) => {\n\n\t\t\tthis.loginErr(err)\n\n\t\t}).catch( e => {\n\t\t\tconsole.warn(e)\n\t\t\tthis.hideSpinner()\n\t\t\tthis.translate.get('There was a problem connecting to the server.').subscribe( text => {\n\t\t\t\talert(text);\n\t\t\t});\n\t\t})\n\t}\n\n\tloginErr( err ) {\n\n\t\tconsole.log(err)\n\n\t\tthis.hideSpinner()\n\n\t\tthis.translate.get('There was a problem, please try again.').subscribe( text => {\n\t\t\tlet msg = text;\n\n\t\t\tif( err.data && err.data.message )\n\t\t\t\tmsg += ' ' + err.data.message\n\n\t\t\talert( msg )\n\t\t});\n\n\t}\n\n\tdoFBLogin() {\n\n\t\tif( typeof this.Device.platform != 'string' && location.port != '8100') {\n\t\t\t\n\t\t\tthis.translate.get('Please try from a device.').subscribe( text => {\n\t\t\t\talert(text);\n\t\t\t})\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.events.subscribe('fb:login', data => {\n\t\t\tconsole.log('captured fb login event', data);\n\t\t\tthis.dismiss();\n\t\t\tif(data.redirect_url)\n\t\t\t\tthis.events.publish('user:login_redirect', data.redirect_url);\n\t\t});\n\t\tthis.fbconnectApp.login();\n\t}\n\n\tdoLogout() {\n\n\t\t// @TODO - Do we need to logout of Facebook too?\n\n\t\tthis.showSpinner();\n\n\t\tthis.fbconnectvars.loggout();\n\n\t\tthis.wplogin.logout().then( response => {\n\n\t\t\tthis.storage.remove( 'user_login' )\n\t\t\tthis.events.publish('user:logout', response )\n\t\t\tthis.login_data = null\n\t\t\tthis.dismiss()\n\t\t\tthis.hideSpinner()\n\n\t\t}, (err) => {\n\n\t\t\tthis.storage.remove( 'user_login' )\n\t\t\tthis.events.publish('user:logout' )\n\t\t\tthis.login_data = null\n\t\t\tthis.hideSpinner()\n\n\t\t\tconsole.log(err)\n\n\t\t\tthis.translate.get('You are logged out of the app, but there was a problem on the server.').subscribe( text => {\n\t\t\t\tlet msg = text;\n\n\t\t\t\tif( err.data && err.data.message )\n\t\t\t\t\tmsg += ' ' + err.data.message\n\n\t\t\t\talert( msg )\n\t\t\t})\n\t\t}).catch( e => {\n\t\t\tconsole.warn(e)\n\t\t\tthis.hideSpinner()\n\t\t\tthis.translate.get('There was a problem connecting to the server.').subscribe( text => {\n\t\t\t\talert(text)\n\t\t\t})\n\t\t})\n\n\t}\n\n\tsetLoginData( data ) {\n\t\tthis.login_data = data\n\t\tconsole.log('setLoginData', this.login_data)\n\t}\n\n\tdismiss() {\n\t\tthis.viewCtrl.dismiss();\n\t}\n\n\tshowSpinner() {\n\t\tthis.spinner = this.loadingCtrl.create();\n\n\t\tthis.spinner.present();\n\t}\n\n\thideSpinner() {\n\t\tthis.spinner.dismiss();\n\t}\n\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login-modal/login-modal.ts"],"sourceRoot":""}